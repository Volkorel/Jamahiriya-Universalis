assassinate_espionage_option = {
	category = covert
	
	require_acceptance = no
	
	is_visible = {
		is_free_or_tributary_trigger = yes
		OR = {
			has_regency = no
			has_consort_regency = yes
		}
		FROM = {
			is_free_or_tributary_trigger = yes
			NOT = { has_country_flag = target_of_assassination_attempt }
		}
	}
	
	is_allowed = {
		if = {
			limit = {
				NOT = { dip_tech = 1 }
			}
			dip_tech = 1
		}
		has_spy_network_in = {
			who = FROM
			value = 75
		}
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			years_of_income = 1
		}
		else = {
			years_of_income = 1.5
		}
		custom_trigger_tooltip = {
			tooltip = DOES_NOT_TRY_TO_ASSASSINATE_SOMEONE_ALREADY
			NOT = { has_country_flag = planning_assassination_in_another_country }
		}
		custom_trigger_tooltip = {
			tooltip = DID_NOT_PLAN_AN_ASSASSINATION_WITHIN_LAST_15_YEARS
			NOT = { has_country_modifier = cooldown_plan_assassination }
		}
		FROM = {
			OR = {
				has_regency = no
				has_consort_regency = yes
				has_heir = yes
				has_consort = yes
			}
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = WAS_NOT_TARGET_OF_AN_ASSASSINATION_WITHIN_LAST_5_TO_10_YEARS
				NOT = { has_country_modifier = increased_spy_defence_because_of_unnoticed_assassination }
				NOT = { has_country_modifier = increased_spy_defence_because_of_noticed_assassination }
				NOT = { has_country_modifier = increased_spy_offence_because_of_assassination }
			}
		}
	}
	
	on_accept = {
		set_country_flag = planning_assassination_in_another_country
		set_country_flag = planning_assassination_in_@FROM
		add_country_modifier = {
			name = cooldown_plan_assassination
			duration = 5475
			hidden = yes
		}
		if = {
			limit = {
				ai = yes
			}
			add_country_modifier = {
				name = ai_cooldown_plan_assassination
				duration = 10950
				hidden = yes
			}
		}
		FROM = {
			set_country_flag = target_of_assassination_attempt
			set_country_flag = target_of_assassination_attempt_of_@ROOT
			country_event = { id = assassinate_espionage_option_mod_events.1 }
		}
		add_spy_network_in = {
			who = FROM
			value = -75
		}
	}
	
	ai_will_do = {
		government = monarchy
		FROM = { government = monarchy }
		NOT = { has_country_modifier = ai_cooldown_plan_assassination }
		NOT = { truce_with = FROM }
		NOT = {
			border_distance = {
				who = FROM
				distance = 1000
			}
		}
		years_of_income = 3
		OR = {
			personality = ai_diplomat
			AND = {
				NOT = { has_dlc = "Rights of Man" }
				personality = ai_balanced
			}
			AND = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = secretive_personality
					ruler_has_personality = intricate_web_weaver_personality
					AND = {
						ruler_has_personality = expansionist_personality
						dynasty = FROM
					}
					AND = {
						ruler_has_personality = conqueror_personality
						dynasty = FROM
					}
					ruler_has_personality = cruel_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = malevolent_personality
				}
			}
		}
		OR = {
			is_rival = FROM
			is_enemy = FROM
			AND = {
				dynasty = FROM
				OR = {
					FROM = {
						has_heir = no
						has_country_flag = ruler_is_target_of_assassination_attempt
					}
					FROM = {
						ruler_age = 60
						has_heir = yes
						has_country_flag = heir_is_target_of_assassination_attempt
					}
				}
			}
			ai_attitude = { who = FROM attitude = attitude_hostile }
		}
		OR = {
			NOT = { has_dlc = "Rights of Man" }
			AND = {
				NOT = { ruler_has_personality = just_personality }
				NOT = { ruler_has_personality = righteous_personality }
				NOT = { ruler_has_personality = tolerant_personality }
				NOT = { ruler_has_personality = kind_hearted_personality }
				NOT = { ruler_has_personality = calm_personality }
				NOT = { ruler_has_personality = well_advised_personality }
				NOT = { ruler_has_personality = benevolent_personality }
			}
		}
		NOT = {
			calc_true_if = {
				all_country = {
					OR = {
						ROOT = { has_country_flag = supported_assassination_in_@PREV }
						has_country_flag = we_are_target_of_assassination_support_of_@ROOT
					}
				}
				amount = 3
			}
		}
	}
}

support_assassination_espionage_option = {
	category = covert
	
	require_acceptance = no
	
	is_visible = {
		is_free_or_tributary_trigger = yes
		OR = {
			has_regency = no
			has_consort_regency = yes
		}
		NOT = { has_country_flag = planning_assassination_in_@FROM }
		NOT = { has_country_flag = supported_assassination_in_@FROM }
		FROM = {
			is_free_or_tributary_trigger = yes
			has_country_flag = target_of_assassination_attempt
			NOT = { has_country_flag = target_of_assassination_attempt_of_@ROOT }
			NOT = { has_country_flag = we_are_target_of_assassination_support_of_@ROOT }
		}
	}
	
	is_allowed = {
		if = {
			limit = {
				NOT = { dip_tech = 1 }
			}
			dip_tech = 1
		}
		has_spy_network_in = {
			who = FROM
			value = 25
		}
		years_of_income = 2
		FROM = {
			custom_trigger_tooltip = {
				tooltip = THE_ASSASSINATION_PLANS_ARE_NOT_MADE_TO_MUCH_TIME_AGO
				has_country_flag = other_countries_can_support_assassination
			}
		}
		custom_trigger_tooltip = {
			tooltip = NOT_5_COUNTRIES_SUPPORT_ASSASSINATION_ALREADY
			NOT = {
				calc_true_if = {
					all_country = {
						OR = {
							has_country_flag = supported_assassination_in_@FROM
							FROM = { has_country_flag = we_are_target_of_assassination_support_of_@PREV }
						}
					}
					amount = 5
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				ai = yes
				NOT = { has_country_modifier = ai_cooldown_plan_assassination }
			}
			add_country_modifier = {
				name = ai_cooldown_plan_assassination
				duration = 1825
				hidden = yes
			}
		}
		add_years_of_income = -2
		set_country_flag = supported_assassination_in_@FROM
		FROM = {
			set_country_flag = we_are_target_of_assassination_support_of_@ROOT
			if = {
				limit = {
					ROOT = { full_idea_group = spy_ideas }
				}
				change_variable = { which = success_chance_of_infanticide value = 4 }
				change_variable = { which = success_chance_of_faked_accident value = 4 }
				change_variable = { which = success_chance_of_poisoned_wine value = 4 }
				change_variable = { which = success_chance_of_poisoned_food value = 4 }
				change_variable = { which = success_chance_of_assault value = 4 }
				change_variable = { which = success_chance_of_assassin value = 4 }
				change_variable = { which = success_chance_of_bribed_guard value = 4 }
				change_variable = { which = success_chance_of_drowning value = 4 }
				change_variable = { which = success_chance_of_balcony_plummet value = 4 }
				change_variable = { which = success_chance_of_disguised_harlot value = 4 }
				change_variable = { which = success_chance_of_disguised_beggar value = 4 }
				change_variable = { which = success_chance_of_disguised_priest value = 4 }
			}
			else = {
				change_variable = { which = success_chance_of_infanticide value = 2 }
				change_variable = { which = success_chance_of_faked_accident value = 2 }
				change_variable = { which = success_chance_of_poisoned_wine value = 2 }
				change_variable = { which = success_chance_of_poisoned_food value = 2 }
				change_variable = { which = success_chance_of_assault value = 2 }
				change_variable = { which = success_chance_of_assassin value = 2 }
				change_variable = { which = success_chance_of_bribed_guard value = 2 }
				change_variable = { which = success_chance_of_drowning value = 2 }
				change_variable = { which = success_chance_of_balcony_plummet value = 2 }
				change_variable = { which = success_chance_of_disguised_harlot value = 2 }
				change_variable = { which = success_chance_of_disguised_beggar value = 2 }
				change_variable = { which = success_chance_of_disguised_priest value = 2 }
			}
			
			# Set base chance to min 0% and max 100%:
			if = {
				limit = {
					check_variable = { which = success_chance_of_infanticide value = 101 }
				}
				set_variable = { which = success_chance_of_infanticide value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_infanticide value = 0 } }
				}
				set_variable = { which = success_chance_of_infanticide value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_faked_accident value = 101 }
				}
				set_variable = { which = success_chance_of_faked_accident value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_faked_accident value = 0 } }
				}
				set_variable = { which = success_chance_of_faked_accident value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_poisoned_wine value = 101 }
				}
				set_variable = { which = success_chance_of_poisoned_wine value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_poisoned_wine value = 0 } }
				}
				set_variable = { which = success_chance_of_poisoned_wine value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_poisoned_food value = 101 }
				}
				set_variable = { which = success_chance_of_poisoned_food value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_poisoned_food value = 0 } }
				}
				set_variable = { which = success_chance_of_poisoned_food value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_assault value = 101 }
				}
				set_variable = { which = success_chance_of_assault value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_assault value = 0 } }
				}
				set_variable = { which = success_chance_of_assault value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_assassin value = 101 }
				}
				set_variable = { which = success_chance_of_assassin value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_assassin value = 0 } }
				}
				set_variable = { which = success_chance_of_assassin value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_bribed_guard value = 101 }
				}
				set_variable = { which = success_chance_of_bribed_guard value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_bribed_guard value = 0 } }
				}
				set_variable = { which = success_chance_of_bribed_guard value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_drowning value = 101 }
				}
				set_variable = { which = success_chance_of_drowning value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_drowning value = 0 } }
				}
				set_variable = { which = success_chance_of_drowning value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_balcony_plummet value = 101 }
				}
				set_variable = { which = success_chance_of_balcony_plummet value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_balcony_plummet value = 0 } }
				}
				set_variable = { which = success_chance_of_balcony_plummet value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_disguised_harlot value = 101 }
				}
				set_variable = { which = success_chance_of_disguised_harlot value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_disguised_harlot value = 0 } }
				}
				set_variable = { which = success_chance_of_disguised_harlot value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_disguised_beggar value = 101 }
				}
				set_variable = { which = success_chance_of_disguised_beggar value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_disguised_beggar value = 0 } }
				}
				set_variable = { which = success_chance_of_disguised_beggar value = 0 }
			}
			if = {
				limit = {
					check_variable = { which = success_chance_of_disguised_priest value = 101 }
				}
				set_variable = { which = success_chance_of_disguised_priest value = 100 }
			}
			if = {
				limit = {
					NOT = { check_variable = { which = success_chance_of_disguised_priest value = 0 } }
				}
				set_variable = { which = success_chance_of_disguised_priest value = 0 }
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -25
		}
		FROM = {
			country_event = { id = assassinate_espionage_option_mod_events.12 }
		}
	}
	
	ai_will_do = {
		NOT = { has_country_flag = planning_assassination_in_another_country }
		years_of_income = 3
		OR = {
			personality = ai_diplomat
			AND = {
				NOT = { has_dlc = "Rights of Man" }
				personality = ai_balanced
			}
			AND = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = secretive_personality
					ruler_has_personality = intricate_web_weaver_personality
					AND = {
						ruler_has_personality = expansionist_personality
						dynasty = FROM
					}
					AND = {
						ruler_has_personality = conqueror_personality
						dynasty = FROM
					}
					ruler_has_personality = cruel_personality
					ruler_has_personality = craven_personality
					ruler_has_personality = malevolent_personality
				}
			}
		}
		OR = {
			is_rival = FROM
			is_enemy = FROM
			AND = {
				dynasty = FROM
				OR = {
					FROM = {
						has_heir = no
						has_country_flag = ruler_is_target_of_assassination_attempt
					}
					FROM = {
						ruler_age = 60
						has_heir = yes
						has_country_flag = heir_is_target_of_assassination_attempt
					}
				}
			}
			any_ally = {
				has_country_flag = planning_assassination_in_another_country
				OR = {
					has_country_flag = planning_assassination_in_@FROM
					FROM = { has_country_flag = target_of_assassination_attempt_of_@PREV }
				}
			}
			ai_attitude = { who = FROM attitude = attitude_hostile }
		}
		OR = {
			NOT = { has_dlc = "Rights of Man" }
			AND = {
				NOT = { ruler_has_personality = just_personality }
				NOT = { ruler_has_personality = righteous_personality }
				NOT = { ruler_has_personality = tolerant_personality }
				NOT = { ruler_has_personality = kind_hearted_personality }
				NOT = { ruler_has_personality = calm_personality }
				NOT = { ruler_has_personality = well_advised_personality }
				NOT = { ruler_has_personality = benevolent_personality }
			}
		}
		NOT = {
			calc_true_if = {
				all_country = {
					OR = {
						ROOT = { has_country_flag = supported_assassination_in_@PREV }
						has_country_flag = we_are_target_of_assassination_support_of_@ROOT
					}
				}
				amount = 3
			}
		}
	}
}

show_their_assassination_target_espionage_option = {
	category = covert
	
	require_acceptance = no
	
	is_visible = {
		is_free_or_tributary_trigger = yes
		full_idea_group = spy_ideas
		FROM = {
			is_free_or_tributary_trigger = yes
		}
	}
	
	is_allowed = {
		if = {
			limit = {
				NOT = { dip_tech = 1 }
			}
			dip_tech = 1
		}
		has_spy_network_in = {
			who = FROM
			value = 95
		}
		treasury = 500
	}
	
	on_accept = {
		FROM = {
			country_event = { id = assassinate_espionage_option_mod_events.18 }
		}
		add_treasury = -500
		add_spy_network_in = {
			who = FROM
			value = -95
		}
		if = {
			limit = {
				ai = yes
			}
			add_country_modifier = {
				name = ai_cooldown_discover_assassinations
				duration = 3650
				hidden = yes
			}
		}
	}
	
	ai_will_do = {
		NOT = { has_country_modifier = ai_cooldown_discover_assassinations }
		OR = {
			is_rival = FROM
			is_enemy = FROM
		}
		OR = {
			AND = {
				NOT = { has_dlc = "Rights of Man" }
				personality = ai_diplomat
			}
			AND = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = secretive_personality
					ruler_has_personality = intricate_web_weaver_personality
				}
			}
		}
	}
}